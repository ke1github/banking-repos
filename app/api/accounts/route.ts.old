import { NextRequest, NextResponse } from "next/server";
import { withAuthRequired, AuthRequiredHandler } from "@/lib/utils/api-utils";
import { getUserBankAccounts } from "@/lib/actions/banking.actions";

/**
 * GET /api/accounts
 * Returns user's bank accounts
 * Requires authentication
 */
const handler: AuthRequiredHandler = async (req: NextRequest, { userId }) => {
  if (req.method !== "GET") {
    return NextResponse.json(
      { message: "Method not allowed", statusCode: 405 },
      { status: 405 }
    );
  }

  const result = await getUserBankAccounts(userId);

  if ("error" in result) {
    return NextResponse.json(
      { message: result.error, statusCode: 400 },
      { status: 400 }
    );
  }

  return NextResponse.json({
    accounts: result.accounts,
  });
};

export const GET = withAuthRequired(handler);
